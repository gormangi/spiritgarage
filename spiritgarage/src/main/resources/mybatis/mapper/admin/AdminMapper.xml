<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.spiritgarage.www.admin.mapper.AdminMapper">
	
	<select id="selectMngrInfo" parameterType="com.spiritgarage.www.admin.vo.MngrVO" resultType="com.spiritgarage.www.admin.vo.MngrVO">
		SELECT
			*
		FROM
			TB_MNGR
		WHERE
			ID = #{id}
			AND
			USE_YN = 'Y'
	</select>
	
	<select id="selectMngrManagementCnt" parameterType="com.spiritgarage.www.admin.vo.MngrVO" resultType="int">
		SELECT COUNT(*) FROM TB_MNGR
	</select>
	
	<select id="selectMngrManagementList" parameterType="com.spiritgarage.www.admin.vo.MngrVO" resultType="com.spiritgarage.www.admin.vo.MngrVO">
		SELECT
			T.RNUM,
			T.MNGR_SEQ,
			T.ID,
			T.PASSWORD,
			T.PASSWORD_KEY,
			T.NAME,
			T.USE_YN,
			T.REG_DATE,
			T.UPT_DATE
		FROM
			(SELECT
				@rownum:=@rownum+1 RNUM,
				M.MNGR_SEQ,
				M.ID,
				M.PASSWORD,
				M.PASSWORD_KEY,
				M.NAME,
				M.USE_YN,
				DATE_FORMAT(M.REG_DATE,'%Y-%m-%d %H:%i') REG_DATE,
				DATE_FORMAT(M.UPT_DATE,'%Y-%m-%d %H:%i') UPT_DATE
			FROM
				TB_MNGR M INNER JOIN (SELECT @ROWNUM := 0) R) T
		LIMIT #{startPostNumber} , #{blockPostCnt}
	</select>
	
	<select id="selectMngrIdCount" parameterType="com.spiritgarage.www.admin.vo.MngrVO" resultType="int">
		SELECT COUNT(*) FROM TB_MNGR WHERE ID = #{id}
	</select>
	
	<select id="selectMngrNameCount" parameterType="com.spiritgarage.www.admin.vo.MngrVO" resultType="int">
		SELECT COUNT(*) FROM TB_MNGR WHERE NAME = #{name}
	</select>
	
	<insert id="insertMngr" parameterType="com.spiritgarage.www.admin.vo.MngrVO">
		INSERT INTO TB_MNGR
		(
			MNGR_SEQ,
			ID,
			PASSWORD,
			PASSWORD_KEY,
			NAME,
			USE_YN,
			REG_DATE
		)VALUES(
			#{mngrSeq},
			#{id},
			#{password},
			#{passwordKey},
			#{name},
			#{useYn},
			NOW()
		)
	</insert>
	
	<select id="selectMngrInfoByMngrSeq" parameterType="com.spiritgarage.www.admin.vo.MngrVO" resultType="com.spiritgarage.www.admin.vo.MngrVO">
		SELECT
			*
		FROM
			TB_MNGR
		WHERE
			MNGR_SEQ = #{mngrSeq}
	</select>
	
	<update id="updateMngr" parameterType="com.spiritgarage.www.admin.vo.MngrVO">
		UPDATE TB_MNGR SET 
			ID = #{id},
			NAME = #{name},
			<if test="password != null and password != ''">
				PASSWORD = #{password},
				PASSWORD_KEY = #{passwordKey},
			</if>
			UPT_DATE = NOW()
		WHERE
			MNGR_SEQ = #{mngrSeq}
	</update>
	
	<update id="updateMngrUseYn" parameterType="com.spiritgarage.www.admin.vo.MngrVO">
		UPDATE TB_MNGR SET
			USE_YN = #{useYn},
			UPT_DATE = NOW()
		WHERE
			MNGR_SEQ = #{mngrSeq}
	</update>
	
	<select id="selectMaintenanceAreaCnt" resultType="int">
		SELECT COUNT(*) FROM TB_MAINTENANCE_AREA
	</select>
	
	<select id="selectMaintenanceAreaList" parameterType="com.spiritgarage.www.reservation.vo.MaintenanceAreaVO" resultType="com.spiritgarage.www.reservation.vo.MaintenanceAreaVO">
		SELECT
			T.RNUM,
			T.MAINTENANCE_AREA_SEQ,
			T.MAINTENANCE_NAME,
			T.REG_DATE
		FROM
			(SELECT
				@rownum:=@rownum+1 RNUM,
				R.MAINTENANCE_AREA_SEQ,
				R.MAINTENANCE_NAME,
				DATE_FORMAT(R.REG_DATE,'%Y-%m-%d %H:%i') REG_DATE
			FROM
				TB_MAINTENANCE_AREA R INNER JOIN (SELECT @ROWNUM := 0) C
			ORDER BY R.REG_DATE DESC) T
		LIMIT #{startPostNumber} , #{blockPostCnt}
	</select>
	
	<select id="selectMaintenanceAreaByName" parameterType="com.spiritgarage.www.reservation.vo.MaintenanceAreaVO" resultType="com.spiritgarage.www.reservation.vo.MaintenanceAreaVO">
		SELECT
			MAINTENANCE_AREA_SEQ,
			MAINTENANCE_NAME,
			DATE_FORMAT(REG_DATE,'%Y-%m-%d %H:%i') REG_DATE
		FROM
			TB_MAINTENANCE_AREA
		WHERE
			MAINTENANCE_NAME = #{maintenanceName}
	</select>
	
	<insert id="insertMaintenanceArea" parameterType="com.spiritgarage.www.reservation.vo.MaintenanceAreaVO">
		INSERT INTO TB_MAINTENANCE_AREA
		(
			MAINTENANCE_AREA_SEQ,
			MAINTENANCE_NAME,
			REG_DATE
		)VALUES(
			#{maintenanceAreaSeq},
			#{maintenanceName},
			NOW()
		)
	</insert>
	
	<delete id="deleteMaintenanceArea" parameterType="com.spiritgarage.www.reservation.vo.MaintenanceAreaVO">
		DELETE FROM TB_MAINTENANCE_AREA WHERE MAINTENANCE_AREA_SEQ = #{maintenanceAreaSeq}
	</delete>
	
	<select id="selectReservationCnt" parameterType="com.spiritgarage.www.reservation.vo.ReservationVO" resultType="int">
		SELECT COUNT(*) FROM TB_RESERVATION
	</select>
	
	<select id="selectReservationList" parameterType="com.spiritgarage.www.reservation.vo.ReservationVO" resultType="com.spiritgarage.www.reservation.vo.ReservationVO">
		SELECT
			T.RNUM,
			T.RESERVATION_SEQ,
			T.RESERVATION_DATE,
			T.RESERVATION_NAME,
			T.PHONE,
			T.CHOOSE_AREA,
			T.RESERVATION_CONTENT,
			T.USE_YN,
			T.REG_DATE,
			T.UPT_DATE
		FROM
			(SELECT
				@rownum:=@rownum+1 RNUM,
				R.RESERVATION_SEQ,
				DATE_FORMAT(R.RESERVATION_DATE,'%Y-%m-%d %H:%i') RESERVATION_DATE,
				R.RESERVATION_NAME,
				R.PHONE,
				R.CHOOSE_AREA,
				R.RESERVATION_CONTENT,
				R.USE_YN,
				DATE_FORMAT(R.REG_DATE,'%Y-%m-%d %H:%i') REG_DATE,
				DATE_FORMAT(R.UPT_DATE,'%Y-%m-%d %H:%i') UPT_DATE
			FROM
				TB_RESERVATION R INNER JOIN (SELECT @ROWNUM := 0) C
			<where>
				R.PHONE LIKE CONCAT('%',#{searchWord},'%') OR R.RESERVATION_NAME LIKE CONCAT('%',#{searchWord},'%')
			</where>
			ORDER BY R.RESERVATION_DATE DESC) T
		LIMIT #{startPostNumber} , #{blockPostCnt}
	</select>
	
	<select id="selectCalendarReservationList" parameterType="com.spiritgarage.www.reservation.vo.ReservationVO" resultType="hashmap">
		SELECT
			RESERVATION_SEQ id,
			DATE_FORMAT(RESERVATION_DATE,'%Y-%m-%d') start,
			CONCAT('[', RESERVATION_NAME,'] ',PHONE) title,
			'black' color,
			'white' textColor
		FROM
			TB_RESERVATION
		WHERE
			USE_YN = 'Y'
			AND
			(PHONE LIKE CONCAT('%',#{searchWord},'%') OR RESERVATION_NAME LIKE CONCAT('%',#{searchWord},'%'))
	</select>
	
	<select id="selectReservationInfo" parameterType="com.spiritgarage.www.reservation.vo.ReservationVO" resultType="com.spiritgarage.www.reservation.vo.ReservationVO">
		SELECT
			R.RESERVATION_SEQ,
			DATE_FORMAT(R.RESERVATION_DATE,'%Y-%m-%d %H:%i') RESERVATION_DATE,
			R.RESERVATION_NAME,
			R.PHONE,
			R.CHOOSE_AREA,
			R.RESERVATION_CONTENT,
			R.USE_YN,
			DATE_FORMAT(R.REG_DATE,'%Y-%m-%d %H:%i') REG_DATE,
			DATE_FORMAT(R.UPT_DATE,'%Y-%m-%d %H:%i') UPT_DATE
		FROM
			TB_RESERVATION R
		WHERE
			R.RESERVATION_SEQ = #{reservationSeq}
	</select>
	
	<update id="updateReservationCancel" parameterType="com.spiritgarage.www.reservation.vo.ReservationVO">
		UPDATE TB_RESERVATION SET USE_YN = 'N' WHERE RESERVATION_SEQ = #{reservationSeq}
	</update>
	
	<update id="updateReservationRep" parameterType="com.spiritgarage.www.reservation.vo.ReservationVO">
		UPDATE TB_RESERVATION SET USE_YN = 'Y' WHERE RESERVATION_SEQ = #{reservationSeq}
	</update>
</mapper>